<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Election Prediction 2020 | Seattle Needles</title>
  <link rel="stylesheet" href="css/main.css">
</head>

<body>
  <div class="navbar">
    <p>Election Prediction 2020</p>
  </div>
  <div id="container"></div>
  <div id="popup">
    <div id="canvas-holder" style="width:60%">
      <span id='close' onclick="closePopup()">&#10006;</span>
      <canvas id="chart-area"></canvas>
    </div>
  </div>
  <!-- /container -->

  <script src="js/raphael-min.js"></script>
  <script src="js/us-map-svg.js"></script>
  <script src="js/chart.min.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/main.js"></script>
  <script>
    function labelPath(pathObj, text) {
      fontSize = 15;
      smallStates = ["VT", "NH", "MA", "RI", "CT", "NJ", "DE", "MD", "DC"]
      if (smallStates.includes(text)) {
        fontSize = 10
      }
      var bbox = pathObj.getBBox();
      x = bbox.x + bbox.width / 2;
      y = bbox.y + bbox.height / 2;
      switch (text) {
        case "CA":
          x -= 18;
          break;
        case "ID":
          y += 20;
          break;
        case "LA":
          x -= 20
          y += 5
          break;
        case "MN":
          x -= 10;
          break;
        case "FL":
          x += 50;
          break;
        case "MI":
          x += 25;
          y += 20;
          break;
        case "KY":
          x += 10;
          break;
        case "VA":
          x += 10;
          break;
        case "NH":
          y += 10;
          break;
        case "MD":
          x += 10;
          break;
        case "DC":
          fontSize = 0;
          break;
      }

      textattr = { 'font-size': fontSize, fill: '#000', stroke: 'none', 'font-family': 'Arial,Helvetica,sans-serif', 'font-weight': 400 };
      var textObj = pathObj.paper.text(x, y, text).attr(textattr);
      return textObj;
    }
    window.onload = function () {
      var R = Raphael("container", 950, 600),
        attr = {
          "fill": "#d3d3d3",
          "stroke": "#fff",
          "stroke-opacity": "1",
          "stroke-linejoin": "round",
          "stroke-miterlimit": "4",
          "stroke-width": "0.75",
          "stroke-dasharray": "none"
        },
        usRaphael = {};

      //Draw Map and store Raphael paths
      for (var state in usMap) {
        usRaphael[state] = R.path(usMap[state]).attr(attr);
      }

      //Initialization
      redStates = ["ak", "mt", "id", "wy", "ut", "nd", "sd", "ne", "ks", "ok", "tx", "la", "ar", "mo", "ia", "ms", "al", "tn", "in", "ky", "oh", "wy", "sc", "nc", "fl"]

      //Do Work on Map
      for (var state in usRaphael) {
        var col = "#4DBBF5";
        if (redStates.includes(state)) {
          col = "#EB6466"
        }
        usRaphael[state].attr("fill", col);
        textObj = labelPath(usRaphael[state], state.toUpperCase());
        (function (st, state, textObj) {

          st[0].style.cursor = "pointer";

          st[0].onmouseover = function () {
            st.animate({ stroke: "#000" }, 500);
            st.toFront();
            textObj.toFront();
            R.safari();
          };

          st[0].onclick = function () {
            showResults(state, usRaphael[state].attrs.fill);
          };

          st[0].onmouseout = function () {
            st.animate({ stroke: "#fff" }, 500);
            st.toFront();
            textObj.toFront();
            R.safari();
          };

        })(usRaphael[state], state, textObj);
      }

    };
  </script>
</body>

</html>